FROM librecat_base
MAINTAINER  Arash Samadi (samadi@sub.uni-goettingen.de)
# 
# Finalizing the LibreCat Image with SUB Layer
#
# Local Layer
ENV LOCAL_LAYER /opt/local
RUN git clone https://github.com/subugoe/goefis.git ${LOCAL_LAYER}
WORKDIR ${LOCAL_LAYER}
RUN npm install \
    && npm run build-css prefix-css

#COPY felix.tgz /tmp
#RUN rm -Rf /srv/LibreCat
#RUN tar xfvz /tmp/felix.tgz -C /srv 

# Configurations
WORKDIR ${LIBRECATHOME}
COPY layers.yml .
COPY boot.sh .
COPY gearman-entrypoint.sh .
COPY docker-entrypoint.sh .

RUN chown -R librecat:librecat ${LIBRECATHOME} ${LOCAL_LAYER}

# Clean up
#RUN apt-get clean \
#    && apt purge -y binutils \
#    wget \
#    git \
#    pwgen \
#    binutils \
#    build-essential \
#    nodejs \
#    g++ \
#    man-db \
#    perl-doc \
#   && apt-get --purge -y autoremove \
#   && rm -rf /var/lib/apt/lists/*

USER librecat:librecat

VOLUME ["/usr/share/elasticsearch/data","/var/lib/mysql", "/srv/LibreCat/logs"]

EXPOSE 3306 4730 5001 9200 9300

ENTRYPOINT ["./docker-entrypoint.sh"]
